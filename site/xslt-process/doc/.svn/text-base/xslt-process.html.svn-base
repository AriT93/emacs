<HTML>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- Created on January, 6  2003 by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HEAD>
<TITLE>XSLT-process minor mode: </TITLE>

<META NAME="description" CONTENT="XSLT-process minor mode: ">
<META NAME="keywords" CONTENT="XSLT-process minor mode: ">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

</HEAD>

<BODY LANG="" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<A NAME="SEC_Top"></A>
<H1>XSLT-process minor mode</H1></P><P>

This document describes XSLT-process, a minor mode for XEmacs/GNU Emacs
that enables it for XSLT processing and debugging.
</P><P>

You can download this document in different formats:

<ul>
<li>PDF: <a href="xslt-process.pdf">xslt-process.pdf</a>
<li>Postscript: <a href="xslt-process.ps">xslt-process.ps</a>
</ul>

</P><P>

<HR SIZE=1>
<A NAME="SEC1"></A>
<A NAME="What is it?"></A>
<H1> 1. What is it? </H1>
<!--docid::SEC1::-->
<P>

<EM>XSLT-process</EM> is a minor mode for XEmacs or GNU Emacs which
transforms it into a powerful XML editor with XSLT processing and
debugging capabilities.
</P><P>

You can invoke an XSLT processor of choice on the current XML file
you're editing, and see the results in another buffer. In case of
errors, the error messages generated by the XSLT processor, are shown in
a compilation buffer, which allows you to quickly go to the location of
the error.
</P><P>

You can also run the XSLT processor in debugging mode, and view step by
step what the XSLT processor is doing. You can view the current stack
frame in the XSLT program, the current XML context node being processed,
the output from the execution of the stylesheet as it is being produced,
what are the local and global variables, set breakpoints in both the XML
source file and the XSLT program.
</P><P>

The principal author of the <EM>XSLT-process</EM> package is
<A HREF="http://webweavertech.com/ovidiu/weblog/">Ovidiu Predescu</A>; major contributions have been made by <A HREF="http://www.cs.salford.ac.uk/web/home.nsf/key/addyman/">Tony Addyman</A>. The package is
distributed under the terms of
<A HREF="http://www.gnu.org/copyleft/gpl.html">GNU General Public
License</A>.
</P><P>

<A NAME="Installation and setup"></A>
<HR SIZE="6">
<A NAME="SEC2"></A>
<H1> 2. Installation and setup </H1>
<!--docid::SEC2::-->
<P>

The <EM>XSLT-process</EM> mode is part of XEmacs, but it works with both
XEmacs and GNU Emacs. The installation differs slighly between the two
editors as we will see shortly.
</P><P>

The mode has been tested on Linux and Windows 2000, with XEmacs and
GNU Emacs, and under MacOS X with
<A HREF="http://webweavertech.com/ovidiu/emacs.html">GNU Emacs</A>. The
development platform however is Linux, so expect this to be the most
stable one.
</P><P>

<A NAME="Package installation under XEmacs"></A>
<HR SIZE="6">
<A NAME="SEC3"></A>
<H2> 2.1 Package installation under XEmacs </H2>
<!--docid::SEC3::-->
<P>

<EM>XSLT-process</EM> is also released as an XEmacs package, so if you're
an XEmacs user, chances are that the package is already installed with
your XEmacs installation. If it's not installed, try obtaining the
latest XEmacs package from your XEmacs local mirror or from the main
XEmacs ftp site. It may happen that the XEmacs package is a little older
than the currently released version of <EM>XSLT-process</EM>, in which
case you want to follow the steps described below.
</P><P>

You can retrieve the XEmacs package either manually from the ftp site,
or by using the "Options" => "Manage packages"
menu. Follow the instructions described under the "Options"
=> "Manage packages" => "Help" menu entry if
you're not familiar with this procedure.
</P><P>

<A NAME="Generic installation"></A>
<HR SIZE="6">
<A NAME="SEC4"></A>
<H2> 2.2 Generic installation </H2>
<!--docid::SEC4::-->
<P>

This section describes how to install <EM>XSLT-process</EM> on your Emacs
editor, assuming either it is not already installed, or you want to
install a new version.
</P><P>

The <EM>XSLT-process</EM> package depends on two other packages:
</P><P>

<UL>

<LI>
<A HREF="ftp://ftp.lysator.liu.se/pub/emacs/elib-1.0.tar.gz">elib 1.0</A>
<P>

<LI>
<A HREF="http://cedet.sourceforge.net/speedbar.shtml">speedbar</A>
<P>

</UL>
<P>

<A NAME="Installing Elib"></A>
<HR SIZE="6">
<A NAME="SEC5"></A>
<H3> 2.2.1 Installing Elib </H3>
<!--docid::SEC5::-->
<P>

If you're running XEmacs, you don't need to install <EM>Elib</EM>, as
XEmacs by default comes with it.
</P><P>

<EM>Elib</EM> provides some useful functionality to Emacs, among other
things a compatibility layer between GNU Emacs and XEmacs.
</P><P>

To install, download it from
<A HREF="ftp://ftp.lysator.liu.se/pub/emacs/elib-1.0.tar.gz">ftp://ftp.lysator.liu.se/pub/emacs/elib-1.0.tar.gz</A>,
and unpack it into your <KBD>~/emacs</KBD> directory. If you don't have a
<KBD>~/emacs</KBD> directory, create one now.
</P><P>

Go to the <KBD>elib-1.0</KBD> directory and run
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>make
</pre></td></tr></table></P><P>

<A NAME="Installing Speedbar"></A>
<HR SIZE="6">
<A NAME="SEC6"></A>
<H3> 2.2.2 Installing Speedbar </H3>
<!--docid::SEC6::-->
<P>

<EM>XSLT-process</EM> depends on <EM>Speedbar</EM>, for displaying
breakpoints, stack frames and global and local variables. You need to
obtain and install this package first, in case you don't have it already
installed.
</P><P>

To verify if you have this package installed, type <KBD>M-x
speedbar-version</KBD>; this will give either an error, if the package is not
installed, or the version number of the <EM>speedbar</EM> package if it's
already installed. You should have at least version 0.13a for
<EM>XSLT-process</EM> to work.
</P><P>

In case you don't have the <EM>speedbar</EM> package, you can obtain it
from its <A HREF="http://cedet.sourceforge.net/speedbar.shtml">Web
site</A>. Unpack the package in your <KBD>~/emacs</KBD> directory. Then go to
the <KBD>speedbar</KBD> directory and run
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>$ make
</pre></td></tr></table></P><P>

If you're using XEmacs, you need to run:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>$ make EMACS=xemacs
</pre></td></tr></table></P><P>

This step byte-compiles all the Lisp files in the <EM>speedbar</EM>
package using your Emacs editor. Please follow Speedbar's installation
document for more up-to-date information on how to compile it.
</P><P>

<A NAME="Installing XSLT-process"></A>
<HR SIZE="6">
<A NAME="SEC7"></A>
<H3> 2.2.3 Installing <EM>XSLT-process</EM> </H3>
<!--docid::SEC7::-->
<P>

To install the <EM>XSLT-process</EM> mode, first obtain the latest stable
version from the SourceForge Web site, at
<A HREF="http://sourceforge.net/projects/xslt-process/">http://sourceforge.net/projects/xslt-process/</A>. Unpack the distribution
in your <KBD>~/emacs</KBD> directory; this will create the
<KBD>xslt-process-2.2</KBD> directory in your <KBD>~/emacs</KBD>
directory.
</P><P>

You now need to tell Emacs to look for the new package in this newly
created directory. You do this by adding the following lines in the
Emacs configuration file <KBD>~/.emacs</KBD> (if you don't have such a file,
create one now):
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(require 'cl)

(mapc (lambda (x)
        (pushnew (expand-file-name x) load-path))
      (list "~/emacs"
            "~/emacs/xslt-process-2.2/lisp"
            "~/emacs/elib-1.0"
            "~/emacs/speedbar-0.14beta4"))
</pre></td></tr></table></P><P>

You can remove the reference to <KBD>elib-1.0</KBD> or <KBD>speedbar-0.14beta4</KBD> in
the lines above, if you didn't have to install either <EM>elib</EM> or
<EM>speedbar</EM> as described in the previous sections.
</P><P>

<A NAME="Setting up XSLT-process"></A>
<HR SIZE="6">
<A NAME="SEC8"></A>
<H2> 2.3 Setting up the <EM>XSLT-process</EM> mode </H2>
<!--docid::SEC8::-->
<P>

<A NAME="IDX1"></A>
<A NAME="IDX2"></A>
<A NAME="IDX3"></A>
<EM>XSLT-process</EM> is an Emacs minor mode, which means is extending the
functionality of whatever mode you use for editing XML or XSLT files,
instead of creating a similar one.
</P><P>

<EM>XSLT-process</EM> does not try to help in the editing of XML or XSLT
files, it just enables Emacs to process such files. Thus
<EM>XSLT-process</EM> should work with any XML/XSLT editing mode your
Emacs is configured for.
</P><P>

<EM>XSLT-process</EM> was tested with both Lennart Staflin's
<A HREF="http://sourceforge.net/projects/psgml">PSGML major mode</A> and James
Clark's <EM>sgml-mode.el</EM> major mode (distributed with GNU Emacs) for
editing XML files. It also works with Tony Graham's
<A HREF="http://sourceforge.net/projects/xslide">xslide</A> XSLT editing mode.
</P><P>

To automatically enable the <EM>XSLT-process</EM> minor mode for the above
major modes, add the following lines in your <KBD>~/.emacs</KBD> file:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(autoload 'xslt-process-mode "xslt-process" "Emacs XSLT processing" t)
(autoload 'xslt-process-install-docbook "xslt-process"
  "Register the DocBook package with XSLT-process" t)
(add-hook 'sgml-mode-hook 'xslt-process-mode)
(add-hook 'xml-mode-hook 'xslt-process-mode)
(add-hook 'xsl-mode-hook 'xslt-process-mode)

(defadvice xml-mode (after run-xml-mode-hooks act)
  "Invoke `xml-mode-hook' hooks in the XML mode."
  (run-hooks 'xml-mode-hook))
</pre></td></tr></table></P><P>

You can also manually switch to this minor mode by typing <KBD>M-x
xslt-process-mode</KBD>.
</P><P>

You can check the modeline to see whether Emacs is in the
<EM>XSLT-process</EM> mode. Look for the "XSLT" indicator in the
modeline.
</P><P>

<IMG SRC="xslt-mode.png" ALT="xslt-mode">
</P><P>

<A NAME="Convenience Settings"></A>
<HR SIZE="6">
<A NAME="SEC9"></A>
<H2> 2.4 Convenience Settings </H2>
<!--docid::SEC9::-->
<P>

Many of the benefits of Emacs in general, and the <EM>XSLT-process</EM>
mode in particular, require the use of a three-button mouse. Under Linux
the emulation of the middle button can be provided by the operating system.
If you are using Windows you can configure Emacs to provide the same
emulation by adding the following lines in your <KBD>~/.emacs</KBD> file:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>; emulate three button mouse
(setq w32-num-mouse-buttons 2)
</pre></td></tr></table></P><P>

<A NAME="Running the XSLT processor"></A>
<HR SIZE="6">
<A NAME="SEC10"></A>
<H1> 3. Running the XSLT processor </H1>
<!--docid::SEC10::-->
<P>

<A NAME="Setting up the XSLT processor"></A>
<HR SIZE="6">
<A NAME="SEC11"></A>
<H2> 3.1 Setting up the XSLT processor </H2>
<!--docid::SEC11::-->
<P>

The <EM>XSLT-process</EM> mode comes by default with two different Java
XSLT processors, Saxon and Xalan. These particular versions of the XSLT
processors (Saxon-6.5.2 and Xalan-2.4.1) have been tested and work with
the <EM>XSLT-process</EM> mode. Different versions of the processors may not
work with the <EM>XSLT-process</EM> mode.
</P><P>

You can choose either of the above processors to do the XSLT processing
by selecting one from the "XSLT" => "XSLT Processor"
menu. The default XSLT processor is Saxon.
</P><P>

<IMG SRC="processors.png" ALT="processors">
</P><P>

<A NAME="Viewing the results of the XSLT processing"></A>
<HR SIZE="6">
<A NAME="SEC12"></A>
<H2> 3.2 Viewing the results of the XSLT processing </H2>
<!--docid::SEC12::-->
<P>

The main functionality of the <EM>XSLT-process</EM> mode is to allow you
to edit an XML document, apply an XSLT stylesheet to the document, and
view the results in a buffer, a Web browser, or a PDF viewer.
</P><P>

<IMG SRC="apply-xslt.png" ALT="apply-xslt">
</P><P>

To run the XSLT processor and view the results in another Emacs buffer,
you can enter <KBD>C-c C-x v</KBD>, while editing the XML
document.
</P><P>

If your stylesheet generates HTML as the result, you can view the
results directly in a Web browser by typing <KBD>C-c C-x n</KBD>. If your
stylesheet generates XML FO as output, <EM>XSLT-process</EM> can translate
it to PDF automatically using the <A HREF="http://xml.apache.org/fop">Apache FOP processor</A>. In this case just type <KBD>C-c C-x p</KBD> and
<EM>XSLT-process</EM> will take care of applying the XSLT stylesheet on
your input XML document, and applying the FOP processor (currently version
0.20.4) on the resulting XSLFO document.
</P><P>

If you choose to view the results in a buffer, they will be shown in the
<CODE>*xslt results*</CODE> buffer. If any message are generated during the
XSLT processing, they are shown separately in the <CODE>*xslt
messages*</CODE> buffer.
</P><P>

You can customize the Web browser and PDF viewer to be used as described
in <A HREF="xslt-process.html#SEC23">5. Customizing the <EM>XSLT-process</EM> mode</A>. If you don't like the
default key bindings described above, you can also customize them as
described in the same chapter.
</P><P>

If the FOP processor is used, any error messages, logging information, etc.
is sent to the <CODE>*Messages*</CODE> buffer. The level of logging provided
by the FOP processor can be customized
(see <A HREF="xslt-process.html#SEC23">5. Customizing the <EM>XSLT-process</EM> mode</A>).
</P><P>

<STRONG>Note:</STRONG> The use of the FOP processor causes two temporary files to
be created in your temporary directory. These are <CODE>xslt-process-output.fo</CODE> and
<CODE>xslt-process-output.pdf</CODE>. If <CODE>xslt-process-output.pdf</CODE> is already
being displayed when a new version of the file is generated the outcome depends
on the PDF viewer being used: either a second window may be opened, so both
versions of the file are displayed, or only the original file
is displayed. If a second window is not opened the <CODE>xslt-process-output.pdf</CODE>
file must be closed and re-opened manually to view the new version.
</P><P>

<STRONG>Note:</STRONG> This use of your temporary directory will fail if the path to the
temporary directory contains spaces. This is the default setting for some versions
of Windows.
</P><P>

<A NAME="Dealing with errors"></A>
<HR SIZE="6">
<A NAME="SEC13"></A>
<H2> 3.3 Dealing with errors </H2>
<!--docid::SEC13::-->
<P>

The <EM>XSLT-process</EM> mode intercepts the error messages generated by
the XML parser or XSLT processor and displays them in compilation
buffer, which quickly allows you to go to the cause of the error.
</P><P>

When you encounter an error, just click using the middle-button
(assuming an X-Windows system or suitable three-button emulation)
on the error message. Emacs will move the cursor point at the place that
caused the error. If you only have a two-button mouse you should can emulate
the third button using the operating system (Linux) or Emacs (Windows)
(see <A HREF="xslt-process.html#SEC9">2.4 Convenience Settings</A>).
</P><P>

<IMG SRC="xslt-errors.png" ALT="xslt-errors">
</P><P>

<A NAME="Associating an XSLT stylesheet with an XML document"></A>
<HR SIZE="6">
<A NAME="SEC14"></A>
<H2> 3.4 Associating an XSLT stylesheet with an XML document </H2>
<!--docid::SEC14::-->
<P>

There are two ways to specify a stylesheet to be used to process an XML
file. The first method uses the so-called <SAMP>`associated stylesheet'</SAMP>,
a XML specific feature, which is specified inside the XML file. The
second method is external to the XML, and is specific to the
<EM>XSLT-process</EM> mode.
</P><P>

<A NAME="Using the associated stylesheet"></A>
<HR SIZE="6">
<A NAME="SEC15"></A>
<H3> 3.4.1 Using the associated stylesheet </H3>
<!--docid::SEC15::-->
<P>

The XSLT file that's used to process the file should be specified inside
the XML file using the XML processing instruction <SAMP>`xml-stylesheet'</SAMP>,
like this:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>&#60;?xml version="1.0"?&#62;
&#60;?xml-stylesheet href="URL/to/XSLT/file" type="text/xsl"?&#62;

...
</pre></td></tr></table></P><P>

You can use any URI understood by your Java system, e.g. file, HTTP or
FTP, to refer to a stylesheet. The XSLT engine will download the
stylesheet from the remote location and make use of it locally. The XSLT
processing code of <EM>XSLT-process</EM> is written such that the
stylesheet is cached, so further invocations won't parse the stylesheet
again, unless the stylesheet is modified.
</P><P>

You can use URLs which are relative to the location of your XML file.
For example if you have an XSLT file <TT>`page-html.xsl'</TT> in the same
directory as the XML file you can simply have inside the XML file the
following processing instruction:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>&#60;?xml version="1.0"?&#62;
&#60;?xml-stylesheet href="page-html.xsl" type="text/xsl"?&#62;

...
</pre></td></tr></table></P><P>

<A NAME="The stylesheet registry"></A>
<HR SIZE="6">
<A NAME="SEC16"></A>
<H3> 3.4.2 The stylesheet registry </H3>
<!--docid::SEC16::-->
<P>

Using the associated stylesheet in the XML document requires the XML
document to have a <CODE>xml-processing</CODE> pseudo-instruction. This is not
always convenient, so <EM>XSLT-process</EM> provides a way to associate
XSLT stylesheets with XML documents.
</P><P>

The stylesheet registry functionality can be found in the menu under
"XSLT" => "Stylesheets Registry".
</P><P>

<IMG SRC="xslt-registry.png" ALT="xslt-registry">
</P><P>

Associating an XSLT stylesheet with and XML document requires the
following steps:
</P><P>

<UL>

<LI>
Registering the XSLT stylesheet into the stylesheet registry. Only
stylesheets registered with the registry can be associated with an XML
document.
<P>

To register a stylesheet in the registry, type <KBD>C-c C-x b</KBD>. This
will prompt you for the buffer name visiting the XSLT stylesheet. Select
the buffer visiting the XSLT stylesheet you want; you can type <KBD>TAB
TAB</KBD> for a list of buffers.
</P><P>

<LI>
Once you have registered stylesheets with the registry, you can
associate XML documents with stylesheets registered with the
registry. Select the buffer visiting the XML document you want and type
<KBD>C-c C-x a</KBD>. You will be prompted in a buffer to choose which
currently registered XSLT stylesheet you want to be associated with the
current XML document.
<P>

If you already have an association between the XML document and an XSLT
stylesheet, it will be selected. If there is no association already
established, the default is setup to use the associated stylesheet
specified with the <CODE>xml-stylesheet</CODE> pseudo-instruction. There is no
check being done to ensure you have such an instruction.
</P><P>

</UL>
<P>

<IMG SRC="assoc-stylesheet.png" ALT="assoc-stylesheet">
</P><P>

To remove or add new XSLT stylesheets, you can type <KBD>C-c C-x
m</KBD>. This will present you a buffer that allows you to remove existing
stylesheets, or to manually add new ones. Adding new ones may be easier
though by visiting the file in a buffer, and typing <KBD>C-c C-x b</KBD>.
</P><P>

Managing the associations between XML documents and XSLT stylesheets is
done in a similar way. Just type <KBD>C-c C-x h</KBD>, and you'll get a
buffer that shows you all the currently registered associations.
</P><P>

If you want to persist the registry across multiple invocations of
Emacs, you need to save it. You can do this from "XSLT" =>
"Stylesheets Registry" => "Save registry".
</P><P>

<A NAME="Changing the XSLT processor"></A>
<HR SIZE="6">
<A NAME="SEC17"></A>
<H2> 3.5 Changing the XSLT processor </H2>
<!--docid::SEC17::-->
<P>

If you want to experiment what are the results of applying your
stylesheets using different XSLT processors, you can change the
processor using the menu "XSLT" => "XSLT Processor", or by using
the customization interface (see <A HREF="xslt-process.html#SEC23">5. Customizing the <EM>XSLT-process</EM> mode</A>).
If you are in the middle of a debugging session, the change will not take
effect until the current session is ended using "Quit XSLT processor".
</P><P>

In certain cases, there are XSLT stylesheets that works only when
processed through a particular XSLT processor. This may happen because
the stylesheet is using XSLT extensions specific to a particular
processor. In this case you can specify the XSLT processor to be used in
the XML source document (see <A HREF="xslt-process.html#SEC24">6. Known problems and limitations</A>).
</P><P>

Just add a <EM>Local Variables</EM> section at the end of your XML file
and specify within it what should be the XSLT processor to be invoked
using the <SAMP>`processor'</SAMP> variable. For example, by adding the
following section at the end of your file, you specify <EM>Saxon</EM> to
be used as the XSLT processor, no matter what is the global XSLT
processor setting:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>&#60;!--
Local Variables:
processor: Saxon
End:
--&#62;
</pre></td></tr></table></P><P>

A <EM>Local Variables</EM> section can be used in the same way at the end of
your XSL file provided that this file is the current buffer when the XSLT
process is executed. This only works if the XSL file is associated with your
XML file using the "Stylesheets Registry", otherwise the current buffer will be
treated as the XML file.
</P><P>

In this release, the acceptable values for <SAMP>`processor'</SAMP> are
<SAMP>`Saxon'</SAMP> and <SAMP>`Xalan'</SAMP>, as they are the only supported
processors. By replacing the value of <SAMP>`processor'</SAMP>, you can run any
of the supported processors on your file.
</P><P>

<A NAME="The XSLT debugger"></A>
<HR SIZE="6">
<A NAME="SEC18"></A>
<H1> 4. The XSLT debugger </H1>
<!--docid::SEC18::-->
<P>

For relatively simple XSLT stylesheets, understanding how a particular
stylesheet works can be done by repeteadly running the XSLT processor,
and looking at the results. More complex stylesheets however, are
difficult to debug this way, especially when you have lots of XSL
variables and key indices.
</P><P>

<EM>XSLT-process</EM> gives you the ability to run the processor in
debugging mode, which allows you to set breakpoints, run step by step,
view local and global XSLT variables, and view the output as it is being
generated. This release supports debugging using both Saxon and Xalan.
</P><P>

<STRONG>Note:</STRONG> Saxon and Xalan operate quite differently internally. This
is reflected in the information displayed by the debugger during the execution
of the stylesheet, sequencing, details of the handling of breakpoints, etc.
</P><P>

<A NAME="Entering the debug mode"></A>
<HR SIZE="6">
<A NAME="SEC19"></A>
<H2> 4.1 Entering the debug mode </H2>
<!--docid::SEC19::-->
<P>

While you're editing an XML or XSLT file, the buffer visiting the file
is read-write, allowing you to perform the normal editing operations,
and use the functionality specific to the XML/XSLT/SGML mode you're
using.
</P><P>

The XSLT debugging mode however does not allow you to modify files, and
it binds some of the keys to debugger specific functionality. The XSLT
debugging functionality is a per buffer feature, you can enable and
disable it for each buffer independently.
</P><P>

To toggle the XSLT debugging functionality, type <KBD>C-c C-x d</KBD> while
you're in a <EM>XSLT-process</EM> mode buffer. You can also toggle the
debug mode through the menu at "XSLT" => "Toggle debug
mode". Once you enter the debug mode, you will notice the modeline
indicator changes from "XSLT" to "XSLTd".
</P><P>

<IMG SRC="xsltd-mode.png" ALT="xsltd-mode">
</P><P>

In the menu, you will observe that until the debug functionality is not
enabled, all the debugger related operations in the menu are
disabled. Once you enable the debug mode, you will be able to setup
breakpoints and run the XSLT debugger.
</P><P>

<TABLE>

<TR><TD>
<IMG SRC="xslt-menu.png" ALT="xslt-menu">
</TD><TD>
<IMG SRC="xsltd-menu.png" ALT="xsltd-menu">

</TR>
<TR><TD>
No debug menu: the debugging functionality is not enabled.
</TD><TD>
XSLT debug menu: debugging functionality enabled.
</TR></TABLE>
<P>

<A NAME="Breakpoints"></A>
<HR SIZE="6">
<A NAME="SEC20"></A>
<H2> 4.2 Breakpoints </H2>
<!--docid::SEC20::-->
<P>

Once you're in the XSLT debugging mode, you can set or delete, enable or
disable breakpoints. During the execution of the XSLT stylesheet, the
XSLT processor will stop when it reaches a breakpoint that is enabled.
</P><P>

The keybindings for breakpoints are:
</P><P>

<UL>

<LI><KBD>b</KBD>:
Set a new breakpoint at the line containing point. Doesn't do anything
if a breakpoint is already setup at this location.
<P>

The corresponding menu item is disabled if the point is on a line where
a breakpoint is already set.
</P><P>

<LI><KBD>d</KBD>:
Delete the breakpoint at the line containing point. Nothing happens if
no breakpoint is setup on the line at point.
<P>

The corresponding menu item is disabled if the point is on a line where
there is no breakpoint.
</P><P>

<LI><KBD>e</KBD>:
Enable or disable the breakpoint at the line containing point. If there
is no breakpoint setup at point, nothing happens. If the breakpoint is
enabled, this action will disable it. Similarly, if the breakpoint is
disabled, this action will enable it.
<P>

The corresponding menu item is disabled if the point is on a line where
there is no breakpoint.
</P><P>

</UL>
<P>

The enabled and disabled breakpoints are shown with distinctive colors,
so you can easily identify them.
</P><P>

You can setup breakpoints both in the source XML document, and in the
XSLT stylesheet program. Note however that the semantic of a breakpoint
in the source document is very different from a breakpoint in the XSLT
stylesheet. The XSLT processor will stop at a breakpoint in the source
document only when an element on that line is <EM>selected</EM>, e.g. when
the element becomes the current context node (see the
<A HREF="http://www.w3c.org/TR/XSLT">XSLT</A> specification). Compare this with
the XSLT stylesheet, which is essentially a program, and where the stop
at a breakpoint means that the execution of the program reached the
instruction at that line.
</P><P>

The two different XSLT processors don't inform the debugger that an element has
been selected in exactly the same circumstances. Saxon only monitors
<CODE>xsl:for-each</CODE> and <CODE>xsl:apply-templates</CODE>; Xalan also monitors
<CODE>xsl:if</CODE>, <CODE>xsl:choose</CODE>, <CODE>xsl:copy-of</CODE>, <CODE>xsl:value-of</CODE>,
<CODE>xsl:variable</CODE> and <CODE>xsl:with-param</CODE>.
</P><P>

<A NAME="Controlling the debugger"></A>
<HR SIZE="6">
<A NAME="SEC21"></A>
<H2> 4.3 Controlling the debugger </H2>
<!--docid::SEC21::-->
<P>

After you setup the breakpoints where you would like the XSLT processor
to stop, you can start the XSLT processing. You can do this from the
menu at "XSLT" => "Run debugger", or by typing
<KBD>r</KBD>.
</P><P>

<STRONG>Important:</STRONG> When starting the debugger, the buffer containing
the XML source document should be current. If a buffer containing an
XSLT document is active instead, the <EM>XSLT-process</EM> mode assumes
this as the source document, and will not be able to find the associated
stylesheet.
</P><P>

The XSLT processor starts. As soon as the XSLT processor generates some
output the <CODE>*xslt-output*</CODE> window will be opened to display that output.
The processor continues running in the background until the execution
reaches an enabled breakpoint. 
</P><P>

At this point, Emacs will highlight the line where the XSLT processor
has stopped and indicate whether the stylesheet is entering "=>" or leaving
"&#60;=" the element. If necessary the stylesheet will be opened in a window. The
location at which the execution has stopped is also displayed in the
mini-buffer. This shows the filename, line number and visit count. The
<EM>visit count</EM> indicates the number of times this breakpoint
has been visited in succession, i.e. without a visit to another breakpoint.
The debugger will wait for an action to be taken. The possible
actions are:
</P><P>

<UL>

<LI>
<EM>Step</EM> (keybinding <KBD>s</KBD>): If the XSLT processor stopped when it
was about to enter an XML element, it will enter it and stop the
execution on the first child element, right before entering it.
<P>

If the XSLT processor stopped when it was exiting from an XML element,
this action will make the processor exit from the current element, and
stop on the immediatelly following element.
</P><P>

This is equivalent with the <EM>step into</EM> action of debuggers for
traditional programming languages.
</P><P>

<LI>
<EM>Next</EM> (keybinding <KBD>n</KBD>): If the XSLT processor was about to
enter an XML element, this action will instruct the processor to skip
the element (this includes on of its sub-elements). The processor will
stop when it is about to visit the next sibling XML element. If there is
no such element, the processor will stop when entering the next XML
element which is to be visited.
<P>

This is equivalent with the <EM>step over</EM> action of debuggers for
traditional languages.
</P><P>

<LI>
<EM>Finish</EM> (keybinding <KBD>f</KBD>): Instructs the XSLT processor to
finish the currently executing XSL template, and stop when exiting from
it. If an enabled breakpoint is reached before the end of the template,
the XSLT processor will stop there.
<P>

This is equivalent with the <EM>finish</EM> action of traditional
debuggers.
</P><P>

<LI>
<EM>Continue</EM> (keybinding <KBD>c</KBD>): Instructs the XSLT processor to
continue the processing until the next enabled breakpoint is encountered
or until the XSLT processing finishes.
<P>

<LI>
<EM>Stop</EM> (keybinding <KBD>a</KBD>): In the case of a long processing,
instruct the XSLT processor to abort it and stop immediately. This is
useful for stylesheets that take a long time to complete, and you forgot
to setup the appropriate breakpoints.
<P>

</UL>
<P>

<IMG SRC="xsltd-stopped.png" ALT="xsltd-stopped">
</P><P>

<A NAME="The speedbar"></A>
<HR SIZE="6">
<A NAME="SEC22"></A>
<H2> 4.4 The speedbar </H2>
<!--docid::SEC22::-->
<P>

The speedbar is a separate Emacs window that allows you to:
</P><P>

<UL>

<LI>
View the breakpoints that you've set. The enabled and disabled
breakpoints are shown with distinctive colors, so you can easily
identify them.
<P>

Clicking on a breakpoint entry in the speedbar will move the point to
the file and line where the breakpoint is set. If the file is not
currently opened within Emacs, it will be opened and shown in a buffer.
</P><P>

<LI>
View the stack of source elements that have been selected during the
processing.
<P>

Whenever you click with the middle button on such a entry, the point is
positioned in the file and line where the source element starts.
</P><P>

<LI>
View the stack of XSLT elements that are currently being executed. Each
element that has been entered, but not yet exited is being shown in the
speedbar.
<P>

<STRONG>Note:</STRONG> This is true if the XSLT elements are instructions. However,
if the elements are literal result elements, nested elements will often
appear in this stack in sequence when debugging using Xalan.
</P><P>

Clicking with the middle button on such a node will position the point
in the file at line where the element starts.
</P><P>

<LI>
View the local and global variables declared with <CODE>xsl:variable</CODE> or
<CODE>xsl:param</CODE>.
<P>

Each entry for a variable has a little icon showing the type of the
variable, its name and value. If images are not supported by your Emacs
(GNU Emacs 20.x and lower), a text indication of the type is shown
instead.
</P><P>

<STRONG>Note:</STRONG> Xalan uses lazy evaluation so a variable might not have its
value computed until it is actually required, i.e. later in the processing.
So it is possible to step through an <CODE>xsl:variable</CODE> element without the
value of the corresponding variable changing within the speedbar display.
The value will subsequently appear when the variable is set prior to being
used. In the limit variables that are never used might never be set.
</P><P>

Below are all the possible XSLT types and how they are displayed by
speedbar:
</P><P>

<UL>

<LI>
<IMG SRC="boolean.png" ALT="boolean">
<CODE>boolean</CODE> - The text representation of an XSLT boolean is <CODE>{b}</CODE>.
<P>

<LI>
<IMG SRC="number.png" ALT="number">
<CODE>number</CODE> - The text representation of an XSLT number is <CODE>{n}</CODE>.
<P>

<LI>
<IMG SRC="string.png" ALT="string">
<CODE>string</CODE> - The text representation of an XSLT string is <CODE>{s}</CODE>.
<P>

<LI>
<IMG SRC="tree.png" ALT="tree">
<CODE>nodeset</CODE> or <CODE>document fragment</CODE> - The text representation of this type is <CODE>{t}</CODE>.
<P>

<LI>
<IMG SRC="object.png" ALT="object">
<CODE>object</CODE> - The text representation of Java object is <CODE>{o}</CODE>.
<P>

<LI>
<IMG SRC="type.png" ALT="type">
<CODE>any</CODE> - This is an unknown XSLT type; its text representation is <CODE>{a}</CODE>.
<P>

</UL>
<P>

</UL>
<P>

<STRONG>Note:</STRONG> If the text representation exceeds 100 characters it is truncated,
and "..." added to the end to indicate that fact. If the text representation
contains line breaks these are replaced by paragraph markers "¶" to ensure the
value can be displayed on a single line as required by the speedbar.
</P><P>

Here is a picture of the speedbar in the <EM>XSLT-process</EM> mode:
</P><P>

<IMG SRC="speedbar.png" ALT="speedbar">
</P><P>

<A NAME="Customizing the XSLT-process mode"></A>
<HR SIZE="6">
<A NAME="SEC23"></A>
<H1> 5. Customizing the <EM>XSLT-process</EM> mode </H1>
<!--docid::SEC23::-->
<P>

You can customize the <EM>XSLT-process</EM> mode in a number of
ways. There are several groups of customizations you can do:
</P><P>

<UL>

<LI>
Select the XSLT processor to be used by the <EM>XSLT-process</EM> mode.
<P>

<LI>
Set global parameters for the transformation.
<P>

<LI>
Customize the environment for the Java process that's running the XSLT
processor.
<P>

<LI>
Customize the faces (the fonts) used when displaying the breakpoints,
the current line etc.
<P>

<LI>
Customize the key bindings used for invoking the processor and for the
debugger.
<P>

<LI>
Customize the Web browser and PDF viewer to be used to directly view the
results of the processing.
<P>

<LI>
Customize the level of logging reported by the FOP processor.
<P>

</UL>
<P>

You can find all the above customization options under the main menu, in
"XSLT" => "Customize". Alternatively, you can run <CODE>M-x
customize-group RET xslt-process</CODE> to get to the main customization page
for <EM>XSLT-process</EM>.
</P><P>

<A NAME="Known problems and limitations"></A>
<HR SIZE="6">
<A NAME="SEC24"></A>
<H1> 6. Known problems and limitations </H1>
<!--docid::SEC24::-->
The code which facilitates the immediate serialization and incremental
display of the output during debugging has to set the encoding of that
output stream. The coding is set to UTF-8 regardless of any setting
in the stylesheet. This only occurs when debugging. If it is a problem
for users, it may be possible to add a customization option in a future
release.
<P>

The following is a list of differences between GNU Emacs and XEmacs. As
the <EM>XSLT-process</EM> mode was originally developed under XEmacs, we would
appreciate your support in making the GNU Emacs version behave closer to
the XEmacs one.
</P><P>

<UL>

<LI>
Under GNU Emacs, the keybinding of a command does not appear in the menu
item in debug mode as they appear under XEmacs.
<P>

</UL>
<P>

<A NAME="Future enhancements"></A>
<HR SIZE="6">
<A NAME="SEC25"></A>
<H1> 7. Future enhancements </H1>
<!--docid::SEC25::-->
<P>

This is a list of features planned for future releases. The list doesn't
specify any particular order in the priority, and the features may or
may not be implemented.
</P><P>

<UL>

<LI>
Add the ability to evaluate XPath expressions. The context node could be
either the top node of the XML document or it can be specified by
putting the point on it.
<P>

This would be a very useful tool for novice XSLT users to learn XPath
(and Emacs ;-). This is a non-trivial enhancement, but one of the
developers would like to have it for teaching purposes. Until this
enhancement is available consider using XPath Explorer (see
<A HREF="http://sourceforge.net/projects/xpe">http://sourceforge.net/projects/xpe</A>)
</P><P>

<LI>
Add the ability to go both forward and backwards in time during
debugging. This would be a nice feature to have for the cases where
reaching the point of interest in the stylesheet takes a lot of time,
and the pressing the wrong key makes you miss it.
<P>

</UL>
<P>

<A NAME="Changes"></A>
<HR SIZE="6">
<A NAME="SEC26"></A>
<H1> 8. Changes </H1>
<!--docid::SEC26::-->
<P>

These are the changes since the 2.1 release:
</P><P>

<UL>

<LI>
Updated the versions of Saxon, Xalan and FOP supported to be 6.5.2,
2.4.1, and 0.20.4 respectively.
<P>

<LI>
Debugging using Xalan is now supported.
<P>

<LI>
During debugging sessions the output produced by executing the stylesheet
is serialized immediately, then displayed and incrementally updated in
an Emacs window.
<P>

<LI>
Added parameter passing to the XSLT processor. These are parameters
that are specified to all the stylesheets, in addition to any other parameters.
They are specified through the customization menu.
<P>

<LI>
Logging output, error messages, etc. generated by the FOP processor
are displayed in the <SAMP>`*Messages*'</SAMP> buffer. The level of logging
can be customized.
<P>

<LI>
Minor improvements to the display of information during debugging.
<P>

</UL>
<P>

These are the changes since the 2.0 release:
</P><P>

<UL>

<LI>
Added the ability to run Apache's FOP processor on the XML document
created as a result of the XSLT processing. Suggestion from
<A HREF="mailto:jeff.rancier@softechnics.com">Jeff Rancier</A>.
<P>

<LI>
Added the ability to pass JVM arguments and properties. Thanks to
<A HREF="mailto:p.lord@russet.org.uk">Phillip Lord</A> for the idea and initial
patch.
<P>

</UL>
<P>

These are the changes since the 1.2.2 release:
</P><P>

<UL>

<LI>
The functionality has been greatly improved, support for debugging and
error reporting has been added.
<P>

<LI>
The code has been completely overhauled. A new dedicated Java command
line tool replaces the more generic BSH process. This command line tool
is the low level interface used by the <EM>XSLT-process</EM> to perform
its functionality, and interacts directly with the XSLT processors.
<P>

<LI>
The project has been moved to Sourceforge, including CVS source tree and
previous releases of the code, and is open to public
participation. Please register on the public mailing list to participate
in discussions related to <EM>XSLT-process</EM>.
<P>

</UL>
<P>

These are the changes since the 1.2 release:
</P><P>

<UL>

<LI>
Fixed problem in accessing stylesheets referred by <KBD>file:</KBD> URIs on
Windows. Reported by <A HREF="mailto:kessler@balcab.ch">Nicolas Kessler</A>.
<P>

</UL>
<P>

This is the list of changes since the 1.1 release.
</P><P>

<UL>

<LI>
Added support for the TrAX interface, part of the JAXP API, thanks to
<A HREF="mailto:a.erskine@cs.ucl.ac.uk">Allan Erskine</A>. Currently Saxon 6.2 and
Xalan2 have been tested. The TrAX interface caches the XSLT stylesheets
in the processor driver in a compiled form, so the speed of the
processing is increased.
<P>

<LI>
The mode is now running with GNU Emacs on Windows NT/2000, thanks to
<A HREF="mailto:a.erskine@cs.ucl.ac.uk">Allan Erskine</A> for figuring out
the issues.
<P>

<LI>
Changed again the keyboard binding to <KBD>C-c C-x C-v</KBD>, as <KBD>C-M-x</KBD>
doesn't work on Windows systems.
<P>

<LI>
The documentation has been reorganized a little bit to be more logical.
<P>

</UL>
<P>

This is the list of changes since the 1.0 release.
</P><P>

<UL>

<LI>
The <SAMP>`xslt-process-additional-classpath'</SAMP> customization variable has
been introduced. Setup this variable with any additional Java classpath
components you want to be passed to the BeanShell when is first
invoked. If you already started a BeanShell, you need to kill the
corresponding buffer (named <SAMP>`*bsh*'</SAMP>) and restart it by invoking
<EM>XSLT-process</EM> on a buffer. (Suggestion from
<A HREF="mailto:tvraman@almaden.ibm.com">T. V. Raman</A>.)
<P>

<LI>
Allow for passing the user agent to the Cocoon processor so that
multiple browser types can be simulated. This works with a patch I
submitted against Cocoon 1.8-dev; it was incorporated and should be
available in the 1.8.1 release. If you need the patch before this
release, feel free to contact me, I'll gladly send it to you.
<P>

<LI>
The way the error messages are displayed has changed, now error messages
messages encountered during the JVM startup process also go in the
<SAMP>`*xslt-output*'</SAMP> buffer.
<P>

<LI>
The default keybinding has been changed to <KBD>C-M-x</KBD> instead of
<KBD>C-c x</KBD>, to conform to the (X)Emacs keybinding standards.
<P>

</UL>
<P>

<HR SIZE="6">
<H1>About this document</H1>
<p>This document was generated by <I>Ovidiu Predescu</I> on <I>January, 6  2003</I>
using <A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>
</p>  
<HR SIZE=1>
</BODY>
</HTML>
